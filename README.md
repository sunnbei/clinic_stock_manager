# クリニック在庫管理システム

クリニック向けの在庫管理Webアプリケーションです。在庫アイテムの管理、セット管理、履歴管理などの機能を提供します。

## 機能一覧

### 1. 在庫アイテム管理
- 在庫アイテムの登録
  - アイテム名
  - 単位
  - 初期数量
- 在庫アイテムの編集
  - アイテム名の変更
  - 単位の変更
- 在庫操作
  - 入庫
  - 出庫（患者名と備考の記録可能）
- 在庫アイテムの削除
  - 在庫数が0の場合のみ削除可能
  - 削除されていないセットに含まれている場合は削除不可
  - 論理削除（履歴は保持される）

### 2. セット管理
- セットの作成
  - 複数の在庫アイテムを組み合わせたセットの作成
  - 各アイテムの数量設定
- セットの編集
  - セット名の変更
  - セットアイテムの追加・削除
  - 各アイテムの数量変更
- セット操作
  - セット入庫
  - セット出庫（患者名と備考の記録可能）
- セットの削除
  - セットに含まれるアイテムの在庫が0の場合のみ削除可能
  - セットに含まれるアイテムが削除されていない他のセットでも使用されている場合は削除不可
  - 論理削除（履歴とセットアイテムの関連は保持される）

### 3. 履歴管理
- 在庫操作履歴の表示
  - 日時
  - アイテム名
  - 操作種類（入庫/出庫）
  - 数量
  - 患者名（出庫時）
  - 備考（出庫時）
- 履歴のCSV出力
  - 全履歴データをCSVファイルとしてダウンロード
- 履歴の取り消し
  - 各履歴の取り消しボタンで操作を元に戻し
  - 在庫も自動的に調整

## 技術スタック

- バックエンド
  - Python 3.11以上
  - Flask 3.0.2
  - Flask-SQLAlchemy 3.1.1
  - SQLAlchemy 2.0.28
- フロントエンド
  - Bootstrap 5.3.0
  - JavaScript

## セットアップ手順

1. 必要なパッケージのインストール
```bash
pip install -r requirements.txt
```

2. アプリケーションの起動
```bash
python app.py
```

3. ブラウザでアクセス
```
http://localhost:5000
```

## 使用方法

### 在庫アイテムの管理

1. 新しい在庫アイテムの追加
   - 「新しい在庫アイテムを追加」ボタンをクリック
   - アイテム名、単位、初期数量を入力
   - 「追加」ボタンをクリック

2. 在庫アイテムの編集
   - 該当アイテムの「編集」ボタンをクリック
   - アイテム名と単位を編集
   - 「更新」ボタンをクリック

3. 在庫操作
   - 入庫：数量を入力して「入庫」ボタンをクリック
   - 出庫：「出庫」ボタンをクリックし、数量、患者名、備考を入力

### セットの管理

1. 新しいセットの作成
   - 「新しいセットを作成」ボタンをクリック
   - セット名を入力
   - アイテムを選択し、数量を設定
   - 「アイテムを追加」ボタンで複数のアイテムを追加可能
   - 「セットを作成」ボタンをクリック

2. セットの編集
   - 該当セットの「編集」ボタンをクリック
   - セット名の変更
   - アイテムの追加・削除・数量変更
   - 「更新」ボタンをクリック

3. セット操作
   - セット入庫：「セット入庫」ボタンをクリック
   - セット出庫：「セット出庫」ボタンをクリックし、患者名と備考を入力
     - セットアイテムは固定（編集不可）
     - 追加アイテムを選択して出庫に含めることが可能

### 履歴の確認と出力

1. 履歴の表示
   - 「在庫履歴を表示」ボタンをクリック
   - 全履歴を時系列で表示

2. 履歴のCSV出力
   - 履歴ページの「CSVダウンロード」ボタンをクリック
   - 履歴データをCSVファイルとしてダウンロード

3. 履歴の取り消し
   - 履歴ページの各履歴の「取り消し」ボタンをクリック
   - 確認ダイアログで「OK」をクリック
   - 在庫が自動的に調整され、履歴が削除される

## 注意事項

- 在庫数が0未満になることはできません
- セット出庫時は、セット内の全アイテムの在庫が十分にあることを確認します
- 履歴の取り消しは在庫不足の場合は実行できません
- データベースファイル（inventory.db）は定期的にバックアップすることを推奨します 